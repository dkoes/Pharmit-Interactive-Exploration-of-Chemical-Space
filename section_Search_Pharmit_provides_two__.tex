\section{Search}

Pharmit provides two search modalities depending on whether the pharmacophore or search query is the primary query.  In both cases, the primary query determines the pose alignment of the hit compounds and the secondary query serves as an additional filter.

\subsection{Pharmacophore/Shape Search}

If the primary query is the pharmacophore query, the selected database searched for compounds that match the specified pharmacophore using the Pharmer \cite{Koes_2011} search technology.  Results are aligned to the pharmacophore to minimize the root mean squared deviation (RMSD) between the query features and the hit compound features. Results are sorted with respect to this pharmacophore RMSD. If a shape query is also present, then the shape constraints are applied to the pharmacophore aligned pose. Search In this modality, only heavy atom centers are compared to the shape constraints.  That is, the pharmacophore-aligned results are filtered to ensure that hits have at least one heavy atom center that falls within the inclusive shape and no heavy atom center that falls within the exclusive shape.  With this modality, the exclusive shape is generally the most useful, as it provides a way to eliminate compounds that match the pharmacophore but have significant steric clashes with the receptor.
Due to the importance and increased specificity of the interactions specified by a pharmacophore, pharmacophore search followed by shape filtering is the default and recommend search modality.

\subsection{Shape/Pharmacophore Search}

If the primary query is the shape query, VAMS \cite{vams} is used to search a shape index \cite{matchpack} for matches.  In this case, all molecules are pre-aligned to their moments of inertia and hits are aligned to the moments of inertia of the query.  Molecular shapes are computed using the solvent excluded volume and are stored at a 0.5{\AA} resolution. A shape matches the query if, in its aligned position, the entirety of the inclusive shape constraint is contained within the shape while no part of the shape overlaps the exclusive shape.  This is a more stringent requirement than that which is imposed when the shape query is used as a filter to a pharmacophore search.
Matching compounds are sorted with respect to their Tanimoto shape similarity with of the query ligand. 

If a pharmacophore query is present, it is used to filter the shape-aligned results. In this case, the pharmacophore features of the hit compound must fall within the tolerance spheres of the pharamacophore query with the compound in the shape-aligned pose. That is, a compound that would match a pharmacophore query if the query were the primary query may still be filtered out.
 
\subsection{Additional Filters}
Pharmit allows users to specify additional, non-structural filters on the results. The number of compounds returned can be reduced by restricting the number poses returned for every conformation, the number of conformations returned for every compound, and the total number of compounds.

Compounds may be filtered by specifying desired ranges for molecular properties that are commonly used to identify drug-like molecule.
These include molecular weight, the number of rotatable bonds, LogP (a measure of lipophilicity), polar surface area (indicative of ability to permeate cell membranes), the number of aromatic groups, the number of hydrogen bond acceptors, and the number of hydrogen bond donors.  Properties are precomputed using OpenBabel \cite{O_Boyle_2011}.

\subsection{Result Browser}
When a database search is initiated, a right sidebar opens to display the search results. This sidebar may be hidden by pressing the right-facing arrow at the top left of the sidebar, or it may be closed by pressing the "x" in the upper right corner. Results may be sorted in increasing or decreasing order based on RMSD, mass, or number of rotatable bonds; the sorting method is determined by pressing on the name of desired sorting method, and pressing the name again to toggle between increasing and decreasing order. Lavender arrowheads to the right of the sorting method names indicate whether sorting is being performed in increasing (up) or decreasing (down) order. 