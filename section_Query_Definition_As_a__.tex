\section{Query Definition}

As a 

\subsection{Inputs}

The typical starting point for a Pharmit session is a ligand-receptor complex structure. A Pharmit session can be automatically initialized using any such structure available in the PDB by inputing the corresponding PDB ascension code and selecting how active site water molecules should be treated (ignored, as part of the receptor, or as part of the ligand).  Alternatively, a user can upload their own complex, in which case the receptor and ligand structures must be in separate files. Any file format supported by OpenBabel \cite{O_Boyle_2011} may be used.  Note that the query ligand must be pre-positioned within the binding site of the receptor - Pharmit does not perform docking. It uses the pharmacophore and shape features of a known ligand to screen for novel compounds.

\subsection{Pharmacophore Queries}
A pharmacophore \cite{Koes_2015rev,Yang_2010,Leach_2010} defines the essential features of an interaction. Importantly, a pharmacophore includes the spatial arrangement of these features. 
Features supported by Pharmit include hydrogen bond acceptors and donors,  negative and positive charges, aromatics, and hydrophobic features.
As shown in Figure~\ref{mainfig}, a pharmacophore query specifies these features using tolerance spheres.  Compounds match if they can be positioned so that their corresponding features are located within these spheres. Some features can have additional constraints, such as direction for hydrogen bonds and aromatics and size (number of atoms) for hydrophobic features.

Pharmit will identify all pharmacophore features present in a provided ligand structure. If a receptor structure is provided, it will identify which of these features are relevant to the protein-ligand interaction using distance cutoffs between corresponding features on the receptor and ligand (e.g., a hydrogen donor on the ligand and acceptor on the receptor). Only the interacting features will be enabled. Alternatively, a pharmacophore query can be initialized using pharmacophore files in MOE \cite{moe}, LigBuilder \cite{Wang_2000}, LigandScout \cite{Wolber_2005}, PharmaGist \cite{Schneidman_Duhovny_2008} or Pharmer \cite{Koes_2011} query formats.  The features of the query can be interactively edited within the Pharmit interface.


\subsection{Shape Queries}

\cite{matchpack}\cite{vams}
Users have the option of using shape as an additional constraint on the similarity search. The ligand's surface or a set of user-defined spheres may be used as an inclusive constraint, the receptor's surface or a set of user-defined spheres may be used as an exclusive constraint, or both inclusive and exclusive shapes may be used. Multiple spheres may be defined for both inclusive and exclusive search by choosing the "Spheres" option in the dropdown menu and pressing "Add". This will display a menu allowing the user to set the position and size of the sphere. Pressing "Add" again will enable the user to continue adding spheres. The shape constraint is applied differently depending on whether it is used to search the database prior to pharmacophore filtering or to filter results returned by a pharmacophore search. In the former case, a shape search returns molecules in the search database that contain the entire included shape and do not overlap any part of the excluded shape. In the latter case, the results of the pharmacophore search are filtered by shape to ensure that at least one heavy atom falls within the inclusive shape and no heavy atom centers fall within any exclusive shape. In either case, the results of the initial search are aligned to that search for the secondary filtering - thus for a given molecule a pose may exist that allows it to meet the secondary filter, but it will not be returned if the aligned pose resulting from the initial search does not meet those constraints. Our recommendation is that users define both inclusive and exclusive shape constraints using the ligand and receptor surfaces and use them as secondary filtering on the results of a pharmacophore search. The order of application of pharmacophore and shape constraints can be swapped using the second button from the top of the left sidebar, which switches between "Pharmacophore Search → Shape Filter" and "Shape Search → Pharmacophore Filter".

\subsection{Visualization}

Next, it will center the features and use a set of default visualization options to display the provided structures, including the electrostatic surface of the receptor. If the user is dissatisfied with the default visualization scheme, they may scroll down to the "Visualization" menu in the left sidebar and toggle the options as desired. In particular, if the electrostatic surface of the receptor is obscuring the pharmacophore features, receptor surface opacity may be reduced and at the lowest setting becomes entirely transparent. In the graphical display window, the left mouse button may be used to rotate the scene and the right mouse button or center wheel may be used to zoom. Clicking on spheres - both pharmacophore spheres and shape constraint spheres - toggles between a solid and wire display. In order to maximize the viewable graphical display area, the sidebar may be hidden by pressing the left-pointing arrowhead at the top right of the sidebar.